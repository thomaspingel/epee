<html>
<head>
<title>Pingel's Epee Scoring Box</title>
<style>

	#left_on_target {
		background-color: black;
		}
	#right_on_target {
		background-color: black;
		}
</style>
 <!--<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.2.min.js"></script> -->
 <script src="jquery-1.12.2.min.js"></script> 
</head>
<body>
<table height="100%" width="100%">
<tr>
<td id="left_on_target"></td>
<td id="right_on_target"></td>
</tr>
</table>

<script>
	<!-- Modeled after Violent Theremin (https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Using_Web_Audio_API) -->
	var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
	var buzzer = audioCtx.createOscillator();
	var gainNode = audioCtx.createGain();

	buzzer.connect(gainNode);
	gainNode.connect(audioCtx.destination);

	// set options for the oscillator
	buzzer.type = 'sine';
	buzzer.frequency.value = 500; // value in hertz
	buzzer.start(0);
	
	audioCtx.suspend();


</script>

<script>
<!-- key assignments -->
var LA_LB = 65  <!-- a -->
var LA_RB = 66  <!-- b -->
var RA_RB = 67 <!-- c -->
var RA_LB = 68 <!-- d -->

<!-- wirestates -->
var la_rb = false;
var ra_lb = false;

mute = false;
light_time = 2000;
light_on = false;
last_left_on_target = 0.0;
last_right_on_target = 0.0;
epee_lockout_time = 45 <!-- Can be 40 to 50 ms -->

LOT = $("#left_on_target")
ROT = $("#right_on_target")


$(document).keydown(function(e){
    if (e.keyCode==LA_RB) la_rb = true;
	if (e.keyCode==RA_LB) ra_lb = true;
	
	if (e.keyCode==LA_LB && !la_rb) {
		last_left_on_target = new Date().getTime();
		console.log(last_left_on_target - last_right_on_target)
		if (last_left_on_target - last_right_on_target <= epee_lockout_time || !light_on) {
			turnOnLight('left_on_target');
		}
	}
	if (e.keyCode==RA_RB && !ra_lb) {
		last_right_on_target = new Date().getTime();
		console.log(last_right_on_target - last_left_on_target)
		if (last_right_on_target - last_left_on_target <= epee_lockout_time || !light_on) {
			turnOnLight('right_on_target');
		}
	}
    <!-- $("body").append(e.keyCode); -->
});

$(document).keyup(function(e){
    if (e.keyCode==LA_RB) la_rb = false;
	if (e.keyCode==RA_LB) ra_lb = false;
});

function turnOnLight(light) {
	if (light=='left_on_target') $("#left_on_target").css('background-color','red');
	else if (light=='right_on_target') $("#right_on_target").css('background-color','green');
	if (!light_on) {
		setTimeout(turnOffLights, light_time);
		light_on = true;
	}
}


function turnOffLights(){
	LOT.css('background-color','black');
	ROT.css('background-color','black');
	light_on = false
}


</script>
</body>
</html>
